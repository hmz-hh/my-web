#!/bin/bash
set -e

sudo apt update && sudo apt upgrade -y
sudo apt install -y python3 python3-pip python3-venv git curl
pip3 install python-telegram-bot==20.3

# ====== Ø±ÙˆØ§Ø¨Ø· ======
BOT_URL="https://example.com/bot"          # ğŸ”´ Ø¨Ø¯Ù‘Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø¯ÙŠØ§Ù„ Ø§Ù„Ø¨ÙˆØª
SCRIPT_URL="https://example.com/addssh.sh" # ğŸ”´ Ø¨Ø¯Ù‘Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø¯ÙŠØ§Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø«Ø§Ù†ÙŠ

# ====== Ù…Ø³Ø§Ø±Ø§Øª ======
BOT_PATH="/usr/bin/bot"
SCRIPT_PATH="/root/addssh.sh"
SERVICE_FILE="/etc/systemd/system/bot.service"

echo "â¬‡ï¸ ÙƒÙŠØ­Ù…Ù‘Ù„ Ø§Ù„Ø¨ÙˆØª Ù…Ù† $BOT_URL ..."
curl -L -o $BOT_PATH $BOT_URL
chmod +x $BOT_PATH

echo "â¬‡ï¸ ÙƒÙŠØ­Ù…Ù‘Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† $SCRIPT_URL ..."
curl -L -o $SCRIPT_PATH $SCRIPT_URL
chmod +x $SCRIPT_PATH

echo "ğŸ”„ ØµØ§ÙŠØ¨ Ø§Ù„Ø®Ø¯Ù…Ø© systemd Ù„Ù„Ø¨ÙˆØª ..."
cat > $SERVICE_FILE <<EOL
[Unit]
Description=My Telegram Bot
After=network.target

[Service]
ExecStart=/usr/bin/python3 $BOT_PATH
WorkingDirectory=/usr/bin
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOL

# Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ systemd
systemctl daemon-reload
systemctl enable bot
systemctl restart bot


#!/bin/bash
set -e

# ========================
# Ø¥Ø¹Ø¯Ø§Ø¯ Ø³ÙƒØ±ÙŠØ¨Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
# ========================
cat << 'EOF' > /usr/bin/auto-restart.sh
#!/bin/bash
while true
do
    systemctl restart bot
    sleep 20
done
EOF

chmod +x /usr/bin/auto-restart.sh

# ========================
# Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø¯Ù…Ø© systemd
# ========================
cat << 'EOF' > /etc/systemd/system/auto-restart.service
[Unit]
Description=Auto Restart Bot Every 20 Seconds
After=network.target

[Service]
ExecStart=/usr/bin/auto-restart.sh
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOF

# ========================
# ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©
# ========================
systemctl daemon-reexec
systemctl enable auto-restart.service
systemctl restart auto-restart.service

echo "âœ… Ø§Ù„Ø®Ø¯Ù…Ø© auto-restart ØªØ®Ø¯Ù…Ø§Øª ÙˆØ¨Ù‚Ø§Øª Ø´ØºØ§Ù„Ø© 24/24"
echo "âœ… Ø§Ù„Ø¨ÙˆØª ØªØ®Ø¯Ù… 24/24 Ø¹Ø¨Ø± systemd!"
echo "ğŸ“‚ addssh.sh ØªÙ†Ø²Ù‘Ù„ ÙÙ€ /root/addssh.sh"
echo "ğŸ” ØªØ´ÙˆÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø¯ÙŠØ§Ù„ Ø§Ù„Ø¨ÙˆØª: systemctl status bot"
