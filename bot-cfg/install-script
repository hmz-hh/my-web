#!/bin/bash
set -e

sudo apt update && sudo apt upgrade -y
sudo apt install -y python3 python3-pip python3-venv git curl
pip3 install python-telegram-bot==20.3

# ====== روابط ======
BOT_URL="https://example.com/bot"          # 🔴 بدّل بالرابط ديال البوت
SCRIPT_URL="https://example.com/addssh.sh" # 🔴 بدّل بالرابط ديال السكريبت الثاني

# ====== مسارات ======
BOT_PATH="/usr/bin/bot"
SCRIPT_PATH="/root/addssh.sh"
SERVICE_FILE="/etc/systemd/system/bot.service"

echo "⬇️ كيحمّل البوت من $BOT_URL ..."
curl -L -o $BOT_PATH $BOT_URL
chmod +x $BOT_PATH

echo "⬇️ كيحمّل السكريبت الإضافي من $SCRIPT_URL ..."
curl -L -o $SCRIPT_PATH $SCRIPT_URL
chmod +x $SCRIPT_PATH

echo "🔄 صايب الخدمة systemd للبوت ..."
cat > $SERVICE_FILE <<EOL
[Unit]
Description=My Telegram Bot
After=network.target

[Service]
ExecStart=/usr/bin/python3 $BOT_PATH
WorkingDirectory=/usr/bin
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOL

# إعادة تحميل systemd
systemctl daemon-reload
systemctl enable bot
systemctl restart bot


#!/bin/bash
set -e

# ========================
# إعداد سكريبت إعادة تشغيل البوت
# ========================
cat << 'EOF' > /usr/bin/auto-restart.sh
#!/bin/bash
while true
do
    systemctl restart bot
    sleep 20
done
EOF

chmod +x /usr/bin/auto-restart.sh

# ========================
# إعداد خدمة systemd
# ========================
cat << 'EOF' > /etc/systemd/system/auto-restart.service
[Unit]
Description=Auto Restart Bot Every 20 Seconds
After=network.target

[Service]
ExecStart=/usr/bin/auto-restart.sh
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOF

# ========================
# تفعيل الخدمة
# ========================
systemctl daemon-reexec
systemctl enable auto-restart.service
systemctl restart auto-restart.service

echo "✅ الخدمة auto-restart تخدمات وبقات شغالة 24/24"
echo "✅ البوت تخدم 24/24 عبر systemd!"
echo "📂 addssh.sh تنزّل فـ /root/addssh.sh"
echo "🔍 تشوف الحالة ديال البوت: systemctl status bot"
