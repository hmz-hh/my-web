#!/bin/bash
set -e

# رابط الملف (بدلو بالرابط ديالك)
BOT_URL="https://example.com/bot"   

# المسار النهائي
BOT_PATH="/usr/bin/bot"
SERVICE_FILE="/etc/systemd/system/bot.service"

echo "⬇️ كيحمّل البوت من $BOT_URL ..."
curl -L -o $BOT_PATH $BOT_URL

# تأكد يكون قابل للتشغيل
chmod +x $BOT_PATH

echo "🔄 صايب الخدمة systemd للبوت ..."

cat > $SERVICE_FILE <<EOL
[Unit]
Description=My Telegram Bot
After=network.target

[Service]
ExecStart=/usr/bin/python3 $BOT_PATH
WorkingDirectory=/usr/bin
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOL

# إعادة تحميل systemd
systemctl daemon-reload

# تفعيل الخدمة باش تبدا مع السيرفر
systemctl enable bot

# تشغيل الخدمة دابا
systemctl restart bot

echo "✅ البوت تخدم 24/24 عبر systemd!"
echo "تشوف الحالة ديالو بهاد الأمر: systemctl status bot"
