#!/bin/bash
set -e

# ==== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ====
BOT_DIR="/usr/bin/telegram"
BOT_FILE="bot.py"
SERVICE_FILE="/etc/systemd/system/telegram-bot.service"
BOT_URL="https://github.com/hmz-hh/pp/raw/refs/heads/main/zi/menu"

# ==== ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø¬Ù„Ø¯ ====
mkdir -p $BOT_DIR

# ==== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ====
wget -q -O $BOT_DIR/$BOT_FILE $BOT_URL
chmod +x $BOT_DIR/$BOT_FILE

# ==== Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø¯Ù…Ø© systemd ====
cat > $SERVICE_FILE <<EOL
[Unit]
Description=Telegram Bot
After=network.target

[Service]
ExecStart=/usr/bin/python3 $BOT_DIR/$BOT_FILE
WorkingDirectory=$BOT_DIR
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target
EOL

# ==== ØªÙØ¹ÙŠÙ„ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© ====
systemctl daemon-reload
systemctl enable telegram-bot
systemctl restart telegram-bot

echo "âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ bot.py ÙˆØªØ´ØºÙŠÙ„Ùˆ 24/24 Ø¹Ø¨Ø± systemd"
echo "ðŸ”Ž ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©: systemctl status telegram-bot"
echo "ðŸ“œ Ø§Ù„Ù„ÙˆØº Ø§Ù„Ù…Ø¨Ø§Ø´Ø±: journalctl -u telegram-bot -f"
