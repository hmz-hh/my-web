#!/bin/bash
set -e

# ==== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ====
BOT_DIR="/usr/bin/telegram"
BOT_FILE="bot.py"
BOT_URL="https://yourdomain.com/path/to/bot.py"   # ðŸ”´ Ø­Ø· Ù‡Ù†Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¯ÙŠØ§Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¯ÙŠØ§Ù„Ùƒ
SERVICE_FILE="/etc/systemd/system/telegram-bot.service"

echo "ðŸ“¦ Installing dependencies..."
sudo apt update -y && sudo apt upgrade -y
sudo apt install -y python3 python3-pip python3-venv screen tmux curl

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯
sudo mkdir -p $BOT_DIR

# ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
sudo curl -fsSL $BOT_URL -o $BOT_DIR/$BOT_FILE

# ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Python
python3 -m venv $BOT_DIR/venv
source $BOT_DIR/venv/bin/activate
pip install --upgrade pip
pip install python-telegram-bot==18.2

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù Ø§Ù„Ø®Ø¯Ù…Ø© systemd
echo "ðŸ› ï¸ Creating systemd service..."
sudo tee $SERVICE_FILE > /dev/null <<EOF
[Unit]
Description=Telegram Bot Service
After=network.target

[Service]
User=root
WorkingDirectory=$BOT_DIR
ExecStart=$BOT_DIR/venv/bin/python3 $BOT_DIR/$BOT_FILE
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©
sudo systemctl daemon-reexec
sudo systemctl enable telegram-bot
sudo systemctl restart telegram-bot

echo "âœ… Bot installed and running as a service (telegram-bot)."
